{% extends 'base.html' %}

{% block content %}
    <h1>{{ titulo }}</h1>

    <!-- Formulario de filtrado por género -->
    <form method="GET" action="{% url 'graph' %}">
        <label for="formato_ficha">Formato:</label>
        <select name="formato_ficha" id="formato_ficha" multiple>
            <option value="movie">Película</option>
            <option value="tvserie">Serie de TV</option>
            <option value="theatre">Obra de teatro</option>
            <option value="musica">Música</option>
            <option value="boardgame">Juego de mesa</option>
            <option value="videogame">Videojuego</option>
            <option value="comic">Cómic</option>
            <option value="novel">Novela</option>
        </select>
        <label for="paises">Paises:</label>
        <select name="paises" id="paises" multiple>
            <!-- Opciones de pais obtenidas de tu base de datos o fijas -->
            {% for pais in paises %}
                <option value="{{ pais }}">{{ pais }}</option>
            {% endfor %}
        </select>
        <label for="genero">Géneros:</label>
        <select name="genero" id="genero" multiple>
            <!-- Opciones de género obtenidas de tu base de datos o fijas -->
            {% for genero in lista_de_generos %}
                <option value="{{ genero }}">{{ genero }}</option>
            {% endfor %}
        </select>
        <label for="keywords">Palabras Clave:</label>
        <select name="keywords" id="keywords" multiple>
            <!-- Opciones de keywords obtenidas de tu base de datos o fijas -->
            {% for keyword in palabras_clave %}
                <option value="{{ keyword }}">{{ keyword }}</option>
            {% endfor %}
        </select>
        <label for="anio_inicio">Año de inicio:</label>
        <select name="anio_inicio" id="anio_inicio">
            {% for anio in anos %}
                <option value="{{ anio }}">{{ anio }}</option>
            {% endfor %}
        </select>

        <label for="anio_fin">Año de fin:</label>
        <select name="anio_fin" id="anio_fin">
            {% for anio in anos %}
                <option value="{{ anio }}" {% if anio == 2030 %} selected {% endif %}>{{ anio }}</option>
            {% endfor %}
        </select>
        <label for="year_range">Creaciones cada:</label>
        <select name="year_range" id="year_range" class="select2">
            {% for anio in rango_anos %}
                <option value="{{ anio }}">{{ anio }}</option>
            {% endfor %}
        </select>
        <button type="submit">Filtrar</button>
    </form>

    <!-- Mostrar el gráfico de barras -->
    <canvas id="grafico"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var data = JSON.parse('{{ data|escapejs }}');
        var ctx = document.getElementById('grafico').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Valores',
                    data: data.values,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {            
                scales: {
                    y: {
                        ticks: {
                            precision: 0, // Configura la precisión del eje y a 0 para mostrar solo valores enteros
                            stepSize: 1 // Establece el tamaño del paso a 1 para asegurar que solo se muestren valores enteros
                        }
                    }
                },
                onClick: function(event, elements) {
                    if (elements.length > 0) {
                        var index = elements[0]._index;
                        var label = data.labels[index];
                        // Aquí rediriges a la URL deseada según la barra clicada
                        console.log('Clic en la barra:', label);
                        window.location.href = '/ruta/a/vista/' + label;
                    }
                }
            }
        });
    </script>


{% endblock %}
